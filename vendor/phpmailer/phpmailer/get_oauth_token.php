<?php
namespace PHPMailer\PHPMailer; use League\OAuth2\Client\Provider\Google; use Hayageek\OAuth2\Client\Provider\Yahoo; use Stevenmaguire\OAuth2\Client\Provider\Microsoft; if (!isset($_GET['code']) && !isset($_GET['provider'])) { ?>
<html>
<body>Select Provider:<br/>
<a href='?provider=Google'>Google</a><br/>
<a href='?provider=Yahoo'>Yahoo</a><br/>
<a href='?provider=Microsoft'>Microsoft/Outlook/Hotmail/Live/Office365</a><br/>
</body>
</html>
<?php  die; } require 'vendor/autoload.php'; session_start(); $sp7fb194 = ''; if (array_key_exists('provider', $_GET)) { $sp7fb194 = $_GET['provider']; $_SESSION['provider'] = $sp7fb194; } elseif (array_key_exists('provider', $_SESSION)) { $sp7fb194 = $_SESSION['provider']; } if (!in_array($sp7fb194, array('Google', 'Microsoft', 'Yahoo'))) { die('Only Google, Microsoft and Yahoo OAuth2 providers are currently supported in this script.'); } $sp39f3a4 = 'RANDOMCHARS-----duv1n2.apps.googleusercontent.com'; $sp2e5974 = 'RANDOMCHARS-----lGyjPcRtvP'; $sp49c8b2 = (isset($_SERVER['HTTPS']) ? 'https://' : 'http://') . $_SERVER['HTTP_HOST'] . $_SERVER['PHP_SELF']; $spfbee46 = array('clientId' => $sp39f3a4, 'clientSecret' => $sp2e5974, 'redirectUri' => $sp49c8b2, 'accessType' => 'offline'); $spb86d46 = array(); $spf789c9 = null; switch ($sp7fb194) { case 'Google': $spf789c9 = new Google($spfbee46); $spb86d46 = array('scope' => array('https://mail.google.com/')); break; case 'Yahoo': $spf789c9 = new Yahoo($spfbee46); break; case 'Microsoft': $spf789c9 = new Microsoft($spfbee46); $spb86d46 = array('scope' => array('wl.imap', 'wl.offline_access')); break; } if (null === $spf789c9) { die('Provider missing'); } if (!isset($_GET['code'])) { $sp5a073d = $spf789c9->getAuthorizationUrl($spb86d46); $_SESSION['oauth2state'] = $spf789c9->getState(); header('Location: ' . $sp5a073d); die; } elseif (empty($_GET['state']) || $_GET['state'] !== $_SESSION['oauth2state']) { unset($_SESSION['oauth2state']); unset($_SESSION['provider']); die('Invalid state'); } else { unset($_SESSION['provider']); $sp6e6c17 = $spf789c9->getAccessToken('authorization_code', array('code' => $_GET['code'])); echo 'Refresh Token: ', $sp6e6c17->getRefreshToken(); }