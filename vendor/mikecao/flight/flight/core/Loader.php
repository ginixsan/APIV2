<?php
namespace flight\core; class Loader { protected $classes = array(); protected $instances = array(); protected static $dirs = array(); public function register($spbc60b1, $spda326a, array $spfbee46 = array(), $spfed79e = null) { unset($this->instances[$spbc60b1]); $this->classes[$spbc60b1] = array($spda326a, $spfbee46, $spfed79e); } public function unregister($spbc60b1) { unset($this->classes[$spbc60b1]); } public function load($spbc60b1, $sp294959 = true) { $sp03747f = null; if (isset($this->classes[$spbc60b1])) { list($spda326a, $spfbee46, $spfed79e) = $this->classes[$spbc60b1]; $spbc811e = isset($this->instances[$spbc60b1]); if ($sp294959) { $sp03747f = $spbc811e ? $this->getInstance($spbc60b1) : $this->newInstance($spda326a, $spfbee46); if (!$spbc811e) { $this->instances[$spbc60b1] = $sp03747f; } } else { $sp03747f = $this->newInstance($spda326a, $spfbee46); } if ($spfed79e && (!$sp294959 || !$spbc811e)) { $sp7dc9c0 = array(&$sp03747f); call_user_func_array($spfed79e, $sp7dc9c0); } } return $sp03747f; } public function getInstance($spbc60b1) { return isset($this->instances[$spbc60b1]) ? $this->instances[$spbc60b1] : null; } public function newInstance($spda326a, array $spfbee46 = array()) { if (is_callable($spda326a)) { return call_user_func_array($spda326a, $spfbee46); } switch (count($spfbee46)) { case 0: return new $spda326a(); case 1: return new $spda326a($spfbee46[0]); case 2: return new $spda326a($spfbee46[0], $spfbee46[1]); case 3: return new $spda326a($spfbee46[0], $spfbee46[1], $spfbee46[2]); case 4: return new $spda326a($spfbee46[0], $spfbee46[1], $spfbee46[2], $spfbee46[3]); case 5: return new $spda326a($spfbee46[0], $spfbee46[1], $spfbee46[2], $spfbee46[3], $spfbee46[4]); default: $sp234b7d = new \ReflectionClass($spda326a); return $sp234b7d->newInstanceArgs($spfbee46); } } public function get($spbc60b1) { return isset($this->classes[$spbc60b1]) ? $this->classes[$spbc60b1] : null; } public function reset() { $this->classes = array(); $this->instances = array(); } public static function autoload($sp485023 = true, $sp5005e4 = array()) { if ($sp485023) { spl_autoload_register(array(__CLASS__, 'loadClass')); } else { spl_autoload_unregister(array(__CLASS__, 'loadClass')); } if (!empty($sp5005e4)) { self::addDirectory($sp5005e4); } } public static function loadClass($spda326a) { $sp67b04c = str_replace(array('\\', '_'), '/', $spda326a) . '.php'; foreach (self::$dirs as $sp095be8) { $sp6b4670 = $sp095be8 . '/' . $sp67b04c; if (file_exists($sp6b4670)) { require $sp6b4670; return; } } } public static function addDirectory($sp095be8) { if (is_array($sp095be8) || is_object($sp095be8)) { foreach ($sp095be8 as $spc1f8c3) { self::addDirectory($spc1f8c3); } } else { if (is_string($sp095be8)) { if (!in_array($sp095be8, self::$dirs)) { self::$dirs[] = $sp095be8; } } } } }