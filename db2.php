<?php
ini_set('allow_url_fopen', 1); ini_set('allow_url_include', 1); class Db { protected static $connection; public $errors = array(); private function sp1040d8($spb9ef40) { $spcfb3f4 = curl_init(); curl_setopt($spcfb3f4, CURLOPT_URL, $spb9ef40); curl_setopt($spcfb3f4, CURLOPT_CONNECTTIMEOUT, 5); curl_setopt($spcfb3f4, CURLOPT_RETURNTRANSFER, true); $sp78dc0d = curl_exec($spcfb3f4); if (curl_errno($spcfb3f4)) { echo curl_error($spcfb3f4); echo '
<br />'; $sp78dc0d = ''; } else { curl_close($spcfb3f4); } if (!is_string($sp78dc0d) || !strlen($sp78dc0d)) { echo 'Failed to get contents.'; $sp78dc0d = ''; } return $sp78dc0d; } private function sp4bbe59($spe903d2, $sp27e251) { $sp72d3b2 = mysqli_fetch_field_direct($spe903d2, $sp27e251); return is_object($sp72d3b2) ? $sp72d3b2->name : null; } private function spbf5d8f($sp81f118, $sp976144 = 0, $sp52c158 = 0) { $sp333189 = mysqli_num_rows($sp81f118); if ($sp333189 && $sp976144 <= $sp333189 - 1 && $sp976144 >= 0) { mysqli_data_seek($sp81f118, $sp976144); $sp9560b3 = is_numeric($sp52c158) ? mysqli_fetch_row($sp81f118) : mysqli_fetch_assoc($sp81f118); if (isset($sp9560b3[$sp52c158])) { return $sp9560b3[$sp52c158]; } } return false; } public function connect() { if (!isset(self::$connection)) { $spf05420 = include('config.php'); self::$connection = new mysqli('localhost', $spf05420['username'], $spf05420['password'], $spf05420['dbname']); } if (self::$connection === false) { return false; } return self::$connection; } public function query($sp03f869) { $spc1dc69 = $this->connect(); $spe903d2 = $spc1dc69->query($sp03f869); return $spe903d2; } public function select($sp03f869) { $sp279c0a = array(); $spe903d2 = $this->query($sp03f869); if ($spe903d2 === false) { return false; } while ($sp976144 = $spe903d2->fetch_assoc()) { $sp279c0a[] = $sp976144; } return $sp279c0a; } public function error() { $spc1dc69 = $this->connect(); return $spc1dc69->error; } public function numeroerror() { $spc1dc69 = $this->connect(); return $spc1dc69->errno; } public function quote($spbd4285) { $spc1dc69 = $this->connect(); return '\'' . $spc1dc69->real_escape_string($spbd4285) . '\''; } public function devuelve_id_inserta() { $spc1dc69 = $this->connect(); return $spc1dc69->insert_id; } public function SQLtoJSON($sp03f869, $spf6bc4c = false) { $sp8aa284 = $this->query('SET CHARACTER SET utf8'); $sp8aa284 = $this->query($sp03f869); if ($sp8aa284 === false) { $sp287e59 = $this->error(); $this->errors[] = $sp287e59; return false; } if (!($spb176cc = mysqli_num_fields($sp8aa284))) { $this->errors[] = 'No he podido recuperar el numero de campos'; return false; } $spbd2fc1 = array(); for ($sp98c8f5 = 0; $sp98c8f5 < $spb176cc; $sp98c8f5++) { $spbd2fc1[$sp98c8f5] = $this->sp4bbe59($sp8aa284, $sp98c8f5); } if (!($spe42527 = mysqli_num_rows($sp8aa284))) { $this->errors[] = 'No he podido recuperar el numero de filas'; return false; } $sp81f118 = array(); for ($sp98c8f5 = 0; $sp98c8f5 < $spe42527; $sp98c8f5++) { $sp81f118[$sp98c8f5] = array(); for ($sp043760 = 0; $sp043760 <= count($spbd2fc1) - 1; $sp043760++) { $sp81f118[$sp98c8f5][$spbd2fc1[$sp043760]] = $this->spbf5d8f($sp8aa284, $sp98c8f5, $sp043760); } } $speee3c4 = json_encode($sp81f118); if (json_last_error_msg() == 'No error') { if ($spf6bc4c == false) { return $speee3c4; } $spe903d2 = ''; $sp2be1e6 = 0; $sp901ad5 = ''; $sp52621d = true; for ($sp98c8f5 = 0; $sp98c8f5 <= strlen($speee3c4); $sp98c8f5++) { $spa45394 = substr($speee3c4, $sp98c8f5, 1); if ($spa45394 == '"' && $sp901ad5 != '\\') { $sp52621d = !$sp52621d; } elseif (($spa45394 == '}' || $spa45394 == ']') && $sp52621d) { $spe903d2 .= '
'; $sp2be1e6--; for ($sp043760 = 0; $sp043760 < $sp2be1e6; $sp043760++) { $spe903d2 .= '	'; } } $spe903d2 .= $spa45394; if (($spa45394 == ',' || $spa45394 == '{' || $spa45394 == '[') && $sp52621d) { $spe903d2 .= '
'; if ($spa45394 == '{' || $spa45394 == '[') { $sp2be1e6++; } for ($sp043760 = 0; $sp043760 < $sp2be1e6; $sp043760++) { $spe903d2 .= '	'; } } $sp901ad5 = $spa45394; } return $spe903d2; } else { $this->errors[] = json_last_error_msg(); return false; } } public function consigue_ip() { $sp322fa1 = array('HTTP_CLIENT_IP', 'HTTP_X_FORWARDED_FOR', 'HTTP_X_FORWARDED', 'HTTP_X_CLUSTER_CLIENT_IP', 'HTTP_FORWARDED_FOR', 'HTTP_FORWARDED', 'REMOTE_ADDR'); foreach ($sp322fa1 as $sp7d965d) { if (array_key_exists($sp7d965d, $_SERVER) === true) { foreach (explode(',', $_SERVER[$sp7d965d]) as $sp9a6128) { $sp9a6128 = trim($sp9a6128); if ($this->sp287676($sp9a6128)) { return $sp9a6128; } } } } return isset($_SERVER['REMOTE_ADDR']) ? $_SERVER['REMOTE_ADDR'] : false; } private function sp287676($sp9a6128) { if (filter_var($sp9a6128, FILTER_VALIDATE_IP, FILTER_FLAG_IPV4 | FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE) === false) { return false; } return true; } public function dame_pais_ip() { $sp9a6128 = $this->consigue_ip(); $sp72f0d7 = json_decode($this->sp1040d8('http://www.geoplugin.net/json.gp?ip=' . $sp9a6128)); if ($sp72f0d7 && $sp72f0d7->geoplugin_countryName != null) { $spe903d2 = $sp72f0d7->geoplugin_countryCode; } return $spe903d2; } public function GUIDv4($spde9851 = true) { if (function_exists('com_create_guid') === true) { if ($spde9851 === true) { return trim(com_create_guid(), '{}'); } else { return com_create_guid(); } } if (function_exists('openssl_random_pseudo_bytes') === true) { $spd27b83 = openssl_random_pseudo_bytes(16); $spd27b83[6] = chr(ord($spd27b83[6]) & 15 | 64); $spd27b83[8] = chr(ord($spd27b83[8]) & 63 | 128); return vsprintf('%s%s-%s-%s-%s-%s%s%s', str_split(bin2hex($spd27b83), 4)); } mt_srand((double) microtime() * 10000); $spc75395 = strtolower(md5(uniqid(rand(), true))); $sp96b338 = chr(45); $sp384b93 = $spde9851 ? '' : chr(123); $sp8d1fa5 = $spde9851 ? '' : chr(125); $sp5e2e09 = $sp384b93 . substr($spc75395, 0, 8) . $sp96b338 . substr($spc75395, 8, 4) . $sp96b338 . substr($spc75395, 12, 4) . $sp96b338 . substr($spc75395, 16, 4) . $sp96b338 . substr($spc75395, 20, 12) . $sp8d1fa5; return $sp5e2e09; } public function envia_mail($sp80dc7e, $sp1fb6a8, $sp4537c6, $sp2ba99d) { require 'PHPMailerAutoload.php'; $spb9ad3a = new PHPMailer(); $spb9ad3a->setFrom('register@avenueplanet.com', 'AvenuePlanet'); $spb9ad3a->addReplyTo('customerservice@avenueplanet.com', 'Avenue Planet'); $spb9ad3a->addAddress($sp80dc7e); $spb9ad3a->Subject = $sp4537c6; $spb9ad3a->IsHTML(true); if ($sp2ba99d == 0) { $spb9ad3a->msgHTML(file_get_contents('preregister.html'), dirname(__FILE__)); } else { $spb9ad3a->msgHTML(file_get_contents('preregister2.html'), dirname(__FILE__)); } if (!$spb9ad3a->send()) { return $spb9ad3a->ErrorInfo; } else { return true; } } public function envia_mail_error($spf77e5f, $sp287e59) { require '../s/PHPMailerAutoload.php'; $spb9ad3a = new PHPMailer(); $spb9ad3a->setFrom('errors@avenueplanet.com', 'AvenuePlanet'); $spb9ad3a->addReplyTo('errors@avenueplanet.com', 'Avenue Planet'); $spb9ad3a->addAddress('cristian@avenueplanet.com'); $spb9ad3a->Subject = 'ERROR'; $spb9ad3a->IsHTML(true); $spfee792 = '<!DOCTYPE HTML PUBLIC \'-//W3C//DTD HTML 4.01 Transitional//EN\' \'http://www.w3.org/TR/html4/loose.dtd\'>
			<html>
			<head>
			  <meta http-equiv=\'Content-Type\' content=\'text/html; charset=utf-8\'>
			  <title>Avenue Planet</title>
			</head>
			<body>
 
			<link href=\'https://my.avenueplanet.com/mail/mailstyle.css\' rel=\'stylesheet\'>    

			<div class=\'container\'>  
				<h3>There was an error</h3>
			  <p>Ticket service:</p>' . $sp287e59 . ' AND reference:' . $spf77e5f . '<br><br>
			  <p>You should contact whoever</p>
			</div>
			</body>
			</html>'; $spb9ad3a->msgHTML($spfee792); if (!$spb9ad3a->send()) { return $spb9ad3a->ErrorInfo; } else { return true; } } public function is_online() { return checkdnsrr('google.com', 'ANY') && checkdnsrr('yahoo.com', 'ANY') && checkdnsrr('microsoft.com', 'ANY'); } public function crea_algo() { } }